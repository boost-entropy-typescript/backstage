## API Report File for "@backstage/backend-plugin-api"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts
/// <reference types="node" />

import { Config } from '@backstage/config';
import { Handler } from 'express';
import { Logger } from 'winston';
import { PermissionAuthorizer } from '@backstage/plugin-permission-common';
import { PermissionEvaluator } from '@backstage/plugin-permission-common';
import { PluginCacheManager } from '@backstage/backend-common';
import { PluginDatabaseManager } from '@backstage/backend-common';
import { PluginTaskScheduler } from '@backstage/backend-tasks';
import { Readable } from 'stream';
import { TokenManager } from '@backstage/backend-common';
import { TransportStreamOptions } from 'winston-transport';

// @public (undocumented)
export interface BackendFeature {
  // (undocumented)
  id: string;
  // (undocumented)
  register(reg: BackendRegistrationPoints): void;
}

// @public (undocumented)
export interface BackendModuleConfig<TOptions> {
  // (undocumented)
  moduleId: string;
  // (undocumented)
  pluginId: string;
  // (undocumented)
  register(
    reg: Omit<BackendRegistrationPoints, 'registerExtensionPoint'>,
    options: TOptions,
  ): void;
}

// @public (undocumented)
export interface BackendPluginConfig<TOptions> {
  // (undocumented)
  id: string;
  // (undocumented)
  register(reg: BackendRegistrationPoints, options: TOptions): void;
}

// @public (undocumented)
export interface BackendRegistrationPoints {
  // (undocumented)
  registerExtensionPoint<TExtensionPoint>(
    ref: ExtensionPoint<TExtensionPoint>,
    impl: TExtensionPoint,
  ): void;
  // (undocumented)
  registerInit<
    Deps extends {
      [name in string]: unknown;
    },
  >(options: {
    deps: {
      [name in keyof Deps]: ServiceRef<Deps[name]> | ExtensionPoint<Deps[name]>;
    };
    init(deps: Deps): Promise<void>;
  }): void;
}

// @public (undocumented)
export type CacheService = PluginCacheManager;

// @public (undocumented)
const cacheServiceRef: ServiceRef<PluginCacheManager, 'plugin'>;

// @public (undocumented)
export type ConfigService = Config;

// @public (undocumented)
const configServiceRef: ServiceRef<Config, 'root'>;

declare namespace coreServices {
  export {
    configServiceRef as config,
    httpRouterServiceRef as httpRouter,
    loggerServiceRef as logger,
    urlReaderServiceRef as urlReader,
    cacheServiceRef as cache,
    databaseServiceRef as database,
    discoveryServiceRef as discovery,
    tokenManagerServiceRef as tokenManager,
    permissionsServiceRef as permissions,
    schedulerServiceRef as scheduler,
    rootLifecycleServiceRef as rootLifecycle,
    rootLoggerServiceRef as rootLogger,
    pluginMetadataServiceRef as pluginMetadata,
    lifecycleServiceRef as lifecycle,
  };
}
export { coreServices };

// @public
export function createBackendModule<
  TOptions extends object | undefined = undefined,
>(
  config: BackendModuleConfig<TOptions>,
): undefined extends TOptions
  ? (options?: TOptions) => BackendFeature
  : (options: TOptions) => BackendFeature;

// @public (undocumented)
export function createBackendPlugin<
  TOptions extends object | undefined = undefined,
>(config: {
  id: string;
  register(reg: BackendRegistrationPoints, options: TOptions): void;
}): undefined extends TOptions
  ? (options?: TOptions) => BackendFeature
  : (options: TOptions) => BackendFeature;

// @public (undocumented)
export function createExtensionPoint<T>(options: {
  id: string;
}): ExtensionPoint<T>;

// @public (undocumented)
export function createServiceFactory<
  TService,
  TScope extends 'root' | 'plugin',
  TImpl extends TService,
  TDeps extends {
    [name in string]: ServiceRef<unknown>;
  },
  TOpts extends object | undefined = undefined,
>(config: {
  service: ServiceRef<TService, TScope>;
  deps: TDeps;
  factory(
    deps: ServiceRefsToInstances<TDeps, 'root'>,
    options: TOpts,
  ): TScope extends 'root'
    ? Promise<TImpl>
    : Promise<(deps: ServiceRefsToInstances<TDeps>) => Promise<TImpl>>;
}): undefined extends TOpts
  ? (options?: TOpts) => ServiceFactory<TService>
  : (options: TOpts) => ServiceFactory<TService>;

// @public (undocumented)
export function createServiceRef<T>(options: {
  id: string;
  scope?: 'plugin';
  defaultFactory?: (
    service: ServiceRef<T, 'plugin'>,
  ) => Promise<ServiceFactory<T> | (() => ServiceFactory<T>)>;
}): ServiceRef<T, 'plugin'>;

// @public (undocumented)
export function createServiceRef<T>(options: {
  id: string;
  scope: 'root';
  defaultFactory?: (
    service: ServiceRef<T, 'root'>,
  ) => Promise<ServiceFactory<T> | (() => ServiceFactory<T>)>;
}): ServiceRef<T, 'root'>;

// @public (undocumented)
export type DatabaseService = PluginDatabaseManager;

// @public (undocumented)
const databaseServiceRef: ServiceRef<PluginDatabaseManager, 'plugin'>;

// @public
export type DiscoveryService = {
  getBaseUrl(pluginId: string): Promise<string>;
  getExternalBaseUrl(pluginId: string): Promise<string>;
};

// @public (undocumented)
const discoveryServiceRef: ServiceRef<DiscoveryService, 'plugin'>;

// @public
export type ExtensionPoint<T> = {
  id: string;
  T: T;
  toString(): string;
  $$ref: 'extension-point';
};

// @public (undocumented)
export interface HttpRouterService {
  // (undocumented)
  use(handler: Handler): void;
}

// @public (undocumented)
const httpRouterServiceRef: ServiceRef<HttpRouterService, 'plugin'>;

// @public (undocumented)
export interface LifecycleService {
  addShutdownHook(options: LifecycleServiceShutdownHook): void;
}

// @public (undocumented)
const lifecycleServiceRef: ServiceRef<LifecycleService, 'plugin'>;

// @public (undocumented)
export type LifecycleServiceShutdownHook = {
  fn: () => void | Promise<void>;
  labels?: Record<string, string>;
};

// @public (undocumented)
export interface LoggerService {
  // (undocumented)
  child(meta: LogMeta): LoggerService;
  // (undocumented)
  debug(message: string, meta?: Error | LogMeta): void;
  // (undocumented)
  error(message: string, meta?: Error | LogMeta): void;
  // (undocumented)
  info(message: string, meta?: Error | LogMeta): void;
  // (undocumented)
  warn(message: string, meta?: Error | LogMeta): void;
}

// @public (undocumented)
const loggerServiceRef: ServiceRef<LoggerService, 'plugin'>;

// @public (undocumented)
export function loggerToWinstonLogger(
  logger: LoggerService,
  opts?: TransportStreamOptions,
): Logger;

// @public (undocumented)
export type LogMeta = {
  [name: string]: unknown;
};

// @public (undocumented)
export type PermissionsService = PermissionEvaluator | PermissionAuthorizer;

// @public (undocumented)
const permissionsServiceRef: ServiceRef<PermissionsService, 'plugin'>;

// @public (undocumented)
export interface PluginMetadataService {
  // (undocumented)
  getId(): string;
}

// @public (undocumented)
const pluginMetadataServiceRef: ServiceRef<PluginMetadataService, 'plugin'>;

// @public
export type ReadTreeOptions = {
  filter?(
    path: string,
    info?: {
      size: number;
    },
  ): boolean;
  etag?: string;
  signal?: AbortSignal;
};

// @public
export type ReadTreeResponse = {
  files(): Promise<ReadTreeResponseFile[]>;
  archive(): Promise<NodeJS.ReadableStream>;
  dir(options?: ReadTreeResponseDirOptions): Promise<string>;
  etag: string;
};

// @public
export type ReadTreeResponseDirOptions = {
  targetDir?: string;
};

// @public
export type ReadTreeResponseFile = {
  path: string;
  content(): Promise<Buffer>;
};

// @public
export type ReadUrlOptions = {
  etag?: string;
  signal?: AbortSignal;
};

// @public
export type ReadUrlResponse = {
  buffer(): Promise<Buffer>;
  stream?(): Readable;
  etag?: string;
};

// @public (undocumented)
export type RootLifecycleService = LifecycleService;

// @public (undocumented)
const rootLifecycleServiceRef: ServiceRef<LifecycleService, 'root'>;

// @public (undocumented)
export type RootLoggerService = LoggerService;

// @public (undocumented)
const rootLoggerServiceRef: ServiceRef<LoggerService, 'root'>;

// @public (undocumented)
export type SchedulerService = PluginTaskScheduler;

// @public (undocumented)
const schedulerServiceRef: ServiceRef<PluginTaskScheduler, 'plugin'>;

// @public
export type SearchOptions = {
  etag?: string;
  signal?: AbortSignal;
};

// @public
export type SearchResponse = {
  files: SearchResponseFile[];
  etag: string;
};

// @public
export type SearchResponseFile = {
  url: string;
  content(): Promise<Buffer>;
};

// @public (undocumented)
export type ServiceFactory<TService = unknown> =
  | {
      scope: 'root';
      service: ServiceRef<TService, 'root'>;
      deps: {
        [key in string]: ServiceRef<unknown>;
      };
      factory(deps: {
        [key in string]: unknown;
      }): Promise<TService>;
    }
  | {
      scope: 'plugin';
      service: ServiceRef<TService, 'plugin'>;
      deps: {
        [key in string]: ServiceRef<unknown>;
      };
      factory(deps: {
        [key in string]: unknown;
      }): Promise<
        (deps: {
          [key in string]: unknown;
        }) => Promise<TService>
      >;
    };

// @public
export type ServiceRef<
  TService,
  TScope extends 'root' | 'plugin' = 'root' | 'plugin',
> = {
  id: string;
  scope: TScope;
  T: TService;
  toString(): string;
  $$ref: 'service';
};

// @public (undocumented)
export type TokenManagerService = TokenManager;

// @public (undocumented)
const tokenManagerServiceRef: ServiceRef<TokenManager, 'plugin'>;

// @public (undocumented)
export type TypesToServiceRef<T> = {
  [key in keyof T]: ServiceRef<T[key]>;
};

// @public
export type UrlReaderService = {
  readUrl(url: string, options?: ReadUrlOptions): Promise<ReadUrlResponse>;
  readTree(url: string, options?: ReadTreeOptions): Promise<ReadTreeResponse>;
  search(url: string, options?: SearchOptions): Promise<SearchResponse>;
};

// @public (undocumented)
const urlReaderServiceRef: ServiceRef<UrlReaderService, 'plugin'>;
```
